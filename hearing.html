<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì • Â· ê²Œì„ ì ‘ê·¼ì„±</title>
    <link rel="stylesheet" href="style.css">
    <style>
      :root {
        --bg: #020617;
        --accent: #7c3aed;
        --accent-soft: rgba(124, 58, 237, 0.18);
        --accent-strong: rgba(124, 58, 237, 0.35);
        --border-subtle: rgba(148, 163, 184, 0.5);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --danger: #f97373;
        --radius-lg: 20px;
        --radius-md: 12px;
        --radius-pill: 999px;
        --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.95);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: var(--text-main);
        background: radial-gradient(circle at top, #111827 0, #020617 52%);
        display: flex;
        align-items: stretch;
        justify-content: center;
        padding: 32px 16px;
      }

      .shell {
        width: 100%;
        max-width: 960px;
        background: radial-gradient(circle at top left, #020617 0, #020617 45%),
          radial-gradient(circle at bottom right, #020617 0, #020617 60%);
        border-radius: 26px;
        border: 1px solid rgba(148, 163, 184, 0.9);
        box-shadow: var(--shadow-soft);
        padding: 20px 22px 22px;
        position: relative;
        overflow: hidden;
      }

      .shell::before {
        content: "";
        position: absolute;
        inset: -35%;
        background:
          radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.24) 0, transparent 55%),
          radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.26) 0, transparent 55%),
          radial-gradient(circle at 50% 120%, rgba(244, 114, 182, 0.18) 0, transparent 58%);
        opacity: 0.9;
        mix-blend-mode: soft-light;
        pointer-events: none;
      }

      .shell-inner {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
        gap: 20px;
      }

      @media (max-width: 880px) {
        body {
          padding: 18px 10px;
        }
        .shell {
          padding: 18px 16px 20px;
          border-radius: 20px;
        }
        .shell-inner {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      header.header {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 8px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 18px;
        background:
          conic-gradient(from 210deg, #7c3aed, #22d3ee, #f97316, #7c3aed);
        padding: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9),
          0 10px 24px rgba(15, 23, 42, 0.9);
      }

      .brand-logo-inner {
        width: 100%;
        height: 100%;
        border-radius: 14px;
        background: radial-gradient(circle at 30% 15%, #e5e7eb, #e5e7eb 5%, #020617 70%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #020617;
        font-size: 15px;
        font-weight: 800;
      }

      .brand-text-main {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .brand-text-main span:first-child {
        font-size: 12px;
        color: var(--text-muted);
        font-weight: 500;
      }

      .brand-text-main span:last-child {
        font-size: 16px;
        font-weight: 650;
      }

      .header-meta {
        text-align: right;
        font-size: 11px;
        color: var(--text-muted);
      }

      .header-meta strong {
        color: #e5e7eb;
        font-weight: 600;
      }

      @media (max-width: 880px) {
        header.header {
          flex-direction: column;
          align-items: flex-start;
        }
        .header-meta {
          text-align: left;
        }
      }

      .panel {
        background: radial-gradient(circle at top left, #020617 0, #020617 55%),
          radial-gradient(circle at bottom right, #020617 0, #020617 60%);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(51, 65, 85, 0.9);
        padding: 16px 16px 18px;
        position: relative;
        overflow: hidden;
      }

      .panel::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top, rgba(148, 163, 184, 0.22), transparent 55%);
        opacity: 0.25;
        pointer-events: none;
      }

      .panel-inner {
        position: relative;
        z-index: 1;
      }

      .section-title {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title-pill {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--text-muted);
        border-radius: var(--radius-pill);
        border: 1px solid rgba(148, 163, 184, 0.6);
        padding: 2px 9px;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.92), #020617);
      }

      .section-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 14px;
      }

      .field-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 10px;
      }

      .field-label-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 4px;
      }

      label {
        font-size: 13px;
        font-weight: 550;
        color: #e5e7eb;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .label-required {
        color: #fbbf24;
        font-size: 11px;
        font-weight: 650;
      }

      .label-helper {
        font-size: 11px;
        color: var(--text-muted);
      }

      .input-shell {
        position: relative;
      }

      .input-shell::before {
        content: "";
        position: absolute;
        inset: -1px;
        border-radius: var(--radius-md);
        background: radial-gradient(circle at top, rgba(148, 163, 184, 0.5), transparent 68%);
        opacity: 0.12;
        pointer-events: none;
      }

      input[type="text"],
      input[type="number"] {
        width: 100%;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
        background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
        color: var(--text-main);
        padding: 9px 11px;
        font-size: 13px;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease,
          background 0.15s ease, transform 0.08s ease;
      }

      input::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      input[type="text"]:hover,
      input[type="number"]:hover {
        border-color: rgba(148, 163, 184, 0.95);
        transform: translateY(-0.5px);
      }

      input[type="text"]:focus-visible,
      input[type="number"]:focus-visible {
        border-color: rgba(129, 140, 248, 0.95);
        box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.7),
          0 0 0 4px rgba(129, 140, 248, 0.35);
        background: radial-gradient(circle at top, #020617 0, #020617 35%, #020617 100%);
      }

      .error-text {
        font-size: 11px;
        color: var(--danger);
        margin-top: 3px;
        min-height: 14px;
      }

      .freq-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 6px;
        margin-top: 4px;
      }

      @media (max-width: 640px) {
        .freq-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .freq-cell {
        border-radius: var(--radius-md);
        border: 1px solid rgba(51, 65, 85, 0.9);
        padding: 6px 8px 7px;
        background: radial-gradient(circle at top, #020617 0, #020617 60%);
      }

      .freq-label {
        font-size: 11px;
        color: var(--text-muted);
        margin-bottom: 3px;
      }

      .freq-input-row {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .freq-input-row span {
        font-size: 11px;
        color: var(--text-muted);
      }

      .freq-input-row input[type="number"] {
        padding: 6px 8px;
        font-size: 12px;
      }

      .side-label {
        font-size: 11px;
        color: var(--text-muted);
      }

      .btn-row {
        margin-top: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn-primary {
        border-radius: var(--radius-pill);
        padding: 8px 16px 8px;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 550;
        color: white;
        background: linear-gradient(120deg, #4f46e5, #7c3aed, #22c55e);
        background-size: 200% 100%;
        box-shadow: 0 14px 30px rgba(15, 23, 42, 1);
        transition: transform 0.08s ease, box-shadow 0.1s ease, filter 0.1s ease,
          background-position 0.15s ease, opacity 0.15s ease;
      }

      .btn-primary:not([disabled]):hover {
        transform: translateY(-1px);
        filter: brightness(1.06);
        background-position: 100% 0;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 1);
      }

      .btn-primary:not([disabled]):active {
        transform: translateY(0);
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.95);
      }

      .btn-primary[disabled] {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
      }

      .btn-secondary {
        border-radius: var(--radius-pill);
        padding: 7px 13px 7px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        font-weight: 500;
        color: rgba(209, 213, 219, 0.95);
        background: radial-gradient(circle at top, #020617, #020617 65%);
        transition: transform 0.08s ease, box-shadow 0.1s ease, filter 0.1s ease;
      }

      .btn-secondary:hover {
        transform: translateY(-1px);
        filter: brightness(1.05);
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.95);
      }

      .btn-secondary:active {
        transform: translateY(0);
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.9);
      }

      .btn-icon {
        width: 18px;
        height: 18px;
        border-radius: 999px;
        background: radial-gradient(circle at 25% 0%, #e5e7eb, #020617 65%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
      }

      .btn-primary-sub {
        font-size: 11px;
        opacity: 0.9;
        font-weight: 500;
      }

      .hint {
        font-size: 11px;
        color: var(--text-muted);
      }

      .hint strong {
        color: #e5e7eb;
        font-weight: 600;
      }

      .status-text {
        font-size: 11px;
        margin-top: 6px;
      }

      .status-text--error {
        color: var(--danger);
      }

      .status-text--ok {
        color: #4ade80;
      }

      .right-body {
        font-size: 12px;
        color: var(--text-muted);
        line-height: 1.5;
      }

      .right-body ul {
        margin: 8px 0 0;
        padding-left: 18px;
      }

      .right-body li {
        margin-bottom: 4px;
      }

      .summary-pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(148, 163, 184, 0.8);
        padding: 3px 8px;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), #020617);
        font-size: 11px;
        margin-top: 4px;
      }

      .screen-reader-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
  </head>
  <body>
    <main class="shell" aria-labelledby="hearing-title">
      <div class="shell-inner">
        <header class="header">
          <div class="brand" aria-label="ì²­ê° ì¸¡ì • ì…ë ¥ í˜ì´ì§€">
            <div class="brand-logo" aria-hidden="true">
              <div class="brand-logo-inner">GA</div>
            </div>
            <div class="brand-text-main">
              <span>ê²Œì„ ì ‘ê·¼ì„± ì¸¡ì •</span>
              <span id="hearing-title">ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì •</span>
            </div>
          </div>
          <div class="header-meta" id="user-summary">
            ì„¸ì…˜ ì •ë³´ ë¡œë”© ì¤‘...
          </div>
        </header>

        <section class="panel" aria-label="ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì •">
          <div class="panel-inner">
            <div class="section-title">
              <span>ì™¸ë¶€ ì•±(Mimi) ì¸¡ì •ê°’ ì…ë ¥</span>
              <span class="section-title-pill">Audio Â· Import</span>
            </div>
            <p class="section-subtitle">
              Mimi ë“± ì™¸ë¶€ ì•±ì—ì„œ ì¸¡ì •í•œ ì²­ë ¥ ê²°ê³¼ë¥¼ ìš”ì•½í•´ ê¸°ë¡í•©ë‹ˆë‹¤. ë°ì‹œë²¨(dB)ê³¼ ì£¼íŒŒìˆ˜(Hz) ëŒ€ì—­ë³„ ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
            </p>

            <form id="hearing-form" novalidate>
              <div class="field-group">
                <div>
                  <div class="field-label-row">
                    <label for="source">
                      ì¸¡ì • ì¶œì²˜
                      <span class="label-required">í•„ìˆ˜</span>
                    </label>
                    <span class="label-helper">
                      ê¸°ë³¸ê°’ì€ Mimië¡œ ë‘ë˜, ë‹¤ë¥¸ ì•±ì„ ì‚¬ìš©í–ˆë‹¤ë©´ ì•± ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.
                    </span>
                  </div>
                  <div class="input-shell">
                    <input
                      type="text"
                      id="source"
                      name="source"
                      autocomplete="off"
                      placeholder="ì˜ˆ: Mimi, Mimi + ë³‘ì› ì²­ë ¥ê²€ì‚¬, ê¸°íƒ€ ì•± ì´ë¦„"
                      aria-describedby="source-error"
                    />
                  </div>
                  <p id="source-error" class="error-text" aria-live="polite"></p>
                </div>

                <div>
                  <div class="field-label-row">
                    <label for="overall-db">
                      ì „ì²´ ì²­ë ¥ ìš”ì•½(dB)
                      <span class="label-required">í•„ìˆ˜</span>
                    </label>
                    <span class="label-helper">
                      Mimiì—ì„œ ì œê³µí•˜ëŠ” ì¢…í•© ì²­ë ¥ ì§€ìˆ˜ ë˜ëŠ” í‰ê·  ì²­ë ¥ ì—­ì¹˜(dB)ë¥¼ ì ì–´ì£¼ì„¸ìš”.
                    </span>
                  </div>
                  <div class="input-shell">
                    <input
                      type="number"
                      id="overall-db"
                      name="overallDb"
                      step="0.1"
                      placeholder="ì˜ˆ: 25 (dB HL ê¸°ì¤€, ìˆ˜ì¹˜ê°€ ë†’ì„ìˆ˜ë¡ ë‚œì²­ ê°€ëŠ¥ì„±â†‘)"
                      aria-describedby="overall-db-error"
                    />
                  </div>
                  <p
                    id="overall-db-error"
                    class="error-text"
                    aria-live="polite"
                  ></p>
                </div>

                <fieldset>
                  <legend class="screen-reader-only">
                    ì¢ŒÂ·ìš° ê·€ ì£¼íŒŒìˆ˜(Hz) ëŒ€ì—­ë³„ ì²­ë ¥ ìˆ˜ì¹˜
                  </legend>
                  <div class="field-label-row">
                    <label>
                      Hz ëŒ€ì—­ë³„ ìˆ˜ì¹˜ (dB HL)
                      <span class="label-required">ê¶Œì¥</span>
                    </label>
                    <span class="label-helper">
                      Mimi ì•±ì—ì„œ ì œê³µí•˜ëŠ” ê° ì£¼íŒŒìˆ˜(250~8000Hz)ë³„ ê²°ê³¼ë¥¼ ì¢Œ/ìš° ê·€ë¡œ
                      ë‚˜ëˆ„ì–´ ì…ë ¥í•©ë‹ˆë‹¤. ì¼ë¶€ ëŒ€ì—­ë§Œ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.
                    </span>
                  </div>

                  <div class="freq-grid">
                    <!-- 250Hz -->
                    <div class="freq-cell">
                      <div class="freq-label">250 Hz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz250-left"
                          name="hz250Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 250Hz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz250-right"
                          name="hz250Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 250Hz dB"
                        />
                      </div>
                    </div>

                    <!-- 500Hz -->
                    <div class="freq-cell">
                      <div class="freq-label">500 Hz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz500-left"
                          name="hz500Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 500Hz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz500-right"
                          name="hz500Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 500Hz dB"
                        />
                      </div>
                    </div>

                    <!-- 1kHz -->
                    <div class="freq-cell">
                      <div class="freq-label">1 kHz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz1000-left"
                          name="hz1000Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 1kHz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz1000-right"
                          name="hz1000Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 1kHz dB"
                        />
                      </div>
                    </div>

                    <!-- 2kHz -->
                    <div class="freq-cell">
                      <div class="freq-label">2 kHz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz2000-left"
                          name="hz2000Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 2kHz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz2000-right"
                          name="hz2000Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 2kHz dB"
                        />
                      </div>
                    </div>

                    <!-- 4kHz -->
                    <div class="freq-cell">
                      <div class="freq-label">4 kHz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz4000-left"
                          name="hz4000Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 4kHz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz4000-right"
                          name="hz4000Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 4kHz dB"
                        />
                      </div>
                    </div>

                    <!-- 8kHz -->
                    <div class="freq-cell">
                      <div class="freq-label">8 kHz</div>
                      <div class="freq-input-row">
                        <span class="side-label">L</span>
                        <input
                          type="number"
                          id="hz8000-left"
                          name="hz8000Left"
                          step="1"
                          placeholder="dB"
                          aria-label="ì™¼ìª½ 8kHz dB"
                        />
                        <span class="side-label">R</span>
                        <input
                          type="number"
                          id="hz8000-right"
                          name="hz8000Right"
                          step="1"
                          placeholder="dB"
                          aria-label="ì˜¤ë¥¸ìª½ 8kHz dB"
                        />
                      </div>
                    </div>
                  </div>
                </fieldset>
              </div>

              <!-- ì–¸ì–´ ëª…ë£Œë„ í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
              <div class="field-group" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(51, 65, 85, 0.9);">
                <div class="section-title" style="margin-bottom: 12px;">
                  <span>ì–¸ì–´ ëª…ë£Œë„ í…ŒìŠ¤íŠ¸</span>
                  <span class="section-title-pill">Speech Clarity</span>
                </div>
                <p class="section-subtitle" style="margin-bottom: 16px;">
                  ì‹œìŠ¤í…œì´ 5ê°œì˜ ë‹¨ì–´ë¥¼ ë“¤ë ¤ì¤ë‹ˆë‹¤. ë“¤ë¦¬ëŠ” ë‹¨ì–´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </p>
                
                <div id="speech-test-container">
                  <div id="speech-test-instructions" class="hint" style="margin-bottom: 12px;">
                    ì¤€ë¹„ë˜ë©´ "í…ŒìŠ¤íŠ¸ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                  </div>
                  
                  <button type="button" class="btn-secondary" id="start-speech-test" style="margin-bottom: 16px;">
                    í…ŒìŠ¤íŠ¸ ì‹œì‘
                  </button>
                  
                  <div id="speech-test-items" style="display: none;">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                  </div>
                  
                  <div id="speech-test-results" style="display: none; margin-top: 16px; padding: 12px; background: rgba(15, 23, 42, 0.5); border-radius: 8px;">
                    <div class="section-title" style="margin-bottom: 8px;">í…ŒìŠ¤íŠ¸ ê²°ê³¼</div>
                    <div id="speech-clarity-score" style="font-size: 18px; font-weight: 600; color: #4ade80;"></div>
                  </div>
                </div>
              </div>

              <!-- ë°œí™” ë¦¬í¬íŠ¸ ì„¹ì…˜ -->
              <div class="field-group" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(51, 65, 85, 0.9);">
                <div class="section-title" style="margin-bottom: 12px;">
                  <span>ë°œí™” ëª…ë£Œë„ ë¦¬í¬íŠ¸</span>
                  <span class="section-title-pill">Observer Report</span>
                </div>
                <p class="section-subtitle" style="margin-bottom: 16px;">
                  ê´€ì°°ìê°€ ìœ ì €ì˜ ëª©ì†Œë¦¬ë¥¼ ë“£ê³  ë°œí™” ëª…ë£Œë„ë¥¼ í‰ê°€í•´ì£¼ì„¸ìš”.
                </p>
                
                <fieldset>
                  <legend class="screen-reader-only">ë°œí™” ëª…ë£Œë„ í‰ê°€</legend>
                  <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.5);">
                      <input type="radio" name="speechClarity" value="1" style="width: auto; margin: 0;">
                      <span>1: ì´í•´ ë¶ˆê°€ - ì „í˜€ ì´í•´í•  ìˆ˜ ì—†ìŒ</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.5);">
                      <input type="radio" name="speechClarity" value="2" style="width: auto; margin: 0;">
                      <span>2: ë§¤ìš° ì–´ë ¤ì›€ - ëŒ€ë¶€ë¶„ ì´í•´í•˜ê¸° ì–´ë ¤ì›€</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.5);">
                      <input type="radio" name="speechClarity" value="3" style="width: auto; margin: 0;">
                      <span>3: ë³´í†µ - ì¼ë¶€ ì´í•´ ê°€ëŠ¥í•˜ë‚˜ ëª…í™•í•˜ì§€ ì•ŠìŒ</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.5);">
                      <input type="radio" name="speechClarity" value="4" style="width: auto; margin: 0;">
                      <span>4: ëª…í™• - ëŒ€ë¶€ë¶„ ì´í•´ ê°€ëŠ¥í•˜ê³  ëª…í™•í•¨</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.5);">
                      <input type="radio" name="speechClarity" value="5" style="width: auto; margin: 0;">
                      <span>5: ë§¤ìš° ëª…í™• - ì™„ë²½í•˜ê²Œ ì´í•´ ê°€ëŠ¥í•¨</span>
                    </label>
                  </div>
                </fieldset>
              </div>

              <div class="btn-row">
                <button
                  type="button"
                  class="btn-secondary"
                  id="back-to-hub"
                  aria-label="í—ˆë¸Œë¡œ ëŒì•„ê°€ê¸°"
                >
                  <span class="btn-icon" aria-hidden="true">â—€</span>
                  <span>í—ˆë¸Œë¡œ ëŒì•„ê°€ê¸°</span>
                </button>
                <p class="hint">
                  <strong>ì €ì¥</strong>ì„ ëˆ„ë¥´ë©´ ì„¸ì…˜ì— ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì • ê²°ê³¼ê°€ ë³‘í•© ì €ì¥ë˜ê³ ,
                  í—ˆë¸Œì—ì„œ ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì • ì§„í–‰ë¥ ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
                </p>
                <button
                  type="submit"
                  class="btn-primary"
                  id="save-hearing"
                  aria-label="ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì • ê²°ê³¼ ì €ì¥ í›„ í—ˆë¸Œë¡œ ëŒì•„ê°€ê¸°"
                >
                  <span class="btn-icon" aria-hidden="true">âœ”</span>
                  <span>ê²°ê³¼ ì €ì¥ & í—ˆë¸Œë¡œ ì´ë™</span>
                  <span class="btn-primary-sub">Save & Return to Hub</span>
                </button>
              </div>
              <p
                id="status-text"
                class="status-text"
                aria-live="polite"
              ></p>
            </form>
          </div>
        </section>

        <aside class="panel" aria-label="ì„¸ì…˜ ê°œìš” ë° ê°€ì´ë“œ">
          <div class="panel-inner">
            <div class="section-title">
              <span>ì„¸ì…˜ ê°œìš”</span>
              <span class="section-title-pill">Audio Â· Context</span>
            </div>
            <div class="right-body">
              <p>
                ì´ ì„¸ì…˜ì—ì„œ ì„ íƒëœ ì¥ì•  ìœ í˜•ì´ ì²­ê°ì–¸ì–´ì¥ì• ì¸ ê²½ìš°, í—ˆë¸Œ í˜ì´ì§€ì—ì„œ ì´ ëª¨ë“ˆì´
                <strong>í•„ìˆ˜ ì¸¡ì •</strong>ìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. Mimi ì•± ê²°ê³¼ì™€ ì–¸ì–´ ëª…ë£Œë„ í…ŒìŠ¤íŠ¸ë¥¼
                ì •í™•íˆ ê¸°ë¡í•´ë‘ë©´, ê²Œì„ ë‚´ ìë§‰/ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ê³„ ì‹œ ì²­ê°ì–¸ì–´ ë³´ì • ê¸°ì¤€ìœ¼ë¡œ
                í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </p>
              <ul>
                <li>
                  <strong>Mimiì—ì„œ ì œê³µí•˜ëŠ” ì£¼íŒŒìˆ˜ë³„ ê·¸ë˜í”„</strong>ë¥¼ ê¸°ì¤€ìœ¼ë¡œ,
                  ëŒ€í‘œê°’ì„ ë°˜ì˜¬ë¦¼í•˜ì—¬ dBë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.
                </li>
                <li>
                  í•œìª½ ê·€ë§Œ ì¸¡ì •ë˜ì—ˆê±°ë‚˜ í•œìª½ ê·€ì—ë§Œ ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°, í•´ë‹¹ ê°’ë§Œ
                  ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.
                </li>
                <li>
                  ì €ì¥ ì‹œ ê¸°ì¡´ ì„¸ì…˜ì˜ <strong>ì‚¬ìš©ì ì •ë³´ ë° ë‹¤ë¥¸ ì¸¡ì • ê²°ê³¼ëŠ” ê·¸ëŒ€ë¡œ
                    ìœ ì§€</strong>ë˜ë©°, ì´ í˜ì´ì§€ì—ì„œ ì…ë ¥í•œ ê°’ë§Œ ë³‘í•©ë©ë‹ˆë‹¤.
                </li>
              </ul>

              <div class="mt-sm text-xs">
                <div>í˜„ì¬ ì„¸ì…˜</div>
                <div class="summary-pill">
                  <span>ID</span>
                  <span id="session-id-text">-</span>
                  <span class="opacity-60 ml-xs">Â·</span>
                  <span>ì¥ì• </span>
                  <span id="session-disability-text">-</span>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <script src="ga-storage.js"></script>
    <script>
      (function () {
        const userSummaryEl = document.getElementById("user-summary");
        const sessionIdText = document.getElementById("session-id-text");
        const sessionDisabilityText = document.getElementById(
          "session-disability-text"
        );
        const form = document.getElementById("hearing-form");
        const statusText = document.getElementById("status-text");
        const backToHubButton = document.getElementById("back-to-hub");

        function readSession() {
          return (typeof GAStorage !== "undefined" && GAStorage.readSession()) || {};
        }

        function writeSession(merge) {
          if (typeof GAStorage !== "undefined") {
            GAStorage.writeSession(merge);
          }
        }

        function updateUserSummary() {
          const session = readSession();
          const id = session.userId || session.id || "-";
          const disability = session.disabilityType || "-";

          sessionIdText.textContent = id || "-";
          sessionDisabilityText.textContent = disability || "-";

          if (!session.disabilityType) {
            userSummaryEl.innerHTML =
              "ì„¸ì…˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë©”ì¸ í˜ì´ì§€ì—ì„œ ì„¸ì…˜ì„ ìƒì„±í•œ ë’¤ í—ˆë¸Œì—ì„œ ì´ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
          } else {
            userSummaryEl.innerHTML =
              'ì„¸ì…˜ <strong>' +
              escapeHtml(id || "unnamed") +
              "</strong> Â· ì¥ì•  ìœ í˜• <strong>" +
              escapeHtml(disability) +
              "</strong>";
          }
        }

        function escapeHtml(str) {
          return String(str)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
        }

        function clearErrors() {
          const errors = form.querySelectorAll(".error-text");
          errors.forEach((el) => {
            el.textContent = "";
          });
          statusText.textContent = "";
          statusText.className = "status-text";
        }

        function validate() {
          clearErrors();
          let valid = true;

          const source = document.getElementById("source");
          const overallDb = document.getElementById("overall-db");

          if (!source.value.trim()) {
            document.getElementById("source-error").textContent =
              "ì¸¡ì •ì— ì‚¬ìš©í•œ ì•±/ë„êµ¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: Mimi)";
            valid = false;
          }
          if (!overallDb.value.trim()) {
            document.getElementById("overall-db-error").textContent =
              "ì „ì²´ ì²­ë ¥ ìš”ì•½ê°’(dB)ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            valid = false;
          }

          return valid;
        }

        function collectFormData() {
          const data = new FormData(form);
          const obj = {};
          data.forEach((value, key) => {
            const v = String(value).trim();
            if (v !== "") {
              obj[key] = v;
            }
          });

          // ì£¼íŒŒìˆ˜ ëŒ€ì—­ êµ¬ì¡°í™”
          const freqs = [250, 500, 1000, 2000, 4000, 8000];
          const band = {};
          freqs.forEach((hz) => {
            const leftKey = "hz" + hz + "Left";
            const rightKey = "hz" + hz + "Right";
            const left = obj[leftKey];
            const right = obj[rightKey];
            if (left || right) {
              band[hz] = {
                left: left !== undefined ? Number(left) : null,
                right: right !== undefined ? Number(right) : null,
              };
            }
          });

          // ì–¸ì–´ ëª…ë£Œë„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê³„ì‚°
          let speechClarityPercent = null;
          let speechTestResults = null;
          if (speechTestAnswers.length > 0) {
            const correctCount = speechTestAnswers.filter(a => a.correct).length;
            speechClarityPercent = (correctCount / SPEECH_TEST_WORDS.length) * 100;
            speechTestResults = {
              words: SPEECH_TEST_WORDS,
              answers: speechTestAnswers,
              correctCount: correctCount,
              totalWords: SPEECH_TEST_WORDS.length,
              clarityPercent: speechClarityPercent
            };
          }

          // ë°œí™” ëª…ë£Œë„ ë¦¬í¬íŠ¸
          const speechClarityRating = obj.speechClarity ? Number(obj.speechClarity) : null;

          const result = {
            source: obj.source || "Mimi",
            overallDb: obj.overallDb ? Number(obj.overallDb) : null,
            bands: band,
            speechClarityTest: speechTestResults,
            speechClarityPercent: speechClarityPercent,
            speechClarityRating: speechClarityRating, // ê´€ì°°ì í‰ê°€ 1-5
            recordedAt: new Date().toISOString(),
          };

          return result;
        }

        // ì–¸ì–´ ëª…ë£Œë„ í…ŒìŠ¤íŠ¸ ë‹¨ì–´ ëª©ë¡
        const SPEECH_TEST_WORDS = ["ì‚¬ê³¼", "ë°”ë‚˜ë‚˜", "ì»´í“¨í„°", "í‚¤ë³´ë“œ", "ë§ˆìš°ìŠ¤"];
        let currentSpeechTestIndex = 0;
        let speechTestAnswers = [];
        let speechTestStarted = false;

        function startSpeechTest() {
          if (speechTestStarted) return;
          speechTestStarted = true;
          currentSpeechTestIndex = 0;
          speechTestAnswers = [];
          
          document.getElementById("start-speech-test").style.display = "none";
          document.getElementById("speech-test-instructions").style.display = "none";
          document.getElementById("speech-test-items").style.display = "block";
          
          playNextWord();
        }

        function playNextWord() {
          if (currentSpeechTestIndex >= SPEECH_TEST_WORDS.length) {
            showSpeechTestResults();
            return;
          }

          const word = SPEECH_TEST_WORDS[currentSpeechTestIndex];
          const container = document.getElementById("speech-test-items");
          
          container.innerHTML = `
            <div style="margin-bottom: 16px;">
              <div class="hint" style="margin-bottom: 8px;">ë‹¨ì–´ ${currentSpeechTestIndex + 1}/5</div>
              <button type="button" class="btn-secondary" id="play-word-btn" style="margin-bottom: 12px;">
                ğŸ”Š ë‹¨ì–´ ë“£ê¸°
              </button>
              <input
                type="text"
                id="speech-input-${currentSpeechTestIndex}"
                placeholder="ë“¤ë¦° ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(51, 65, 85, 0.9); background: #020617; color: #e5e7eb; font-size: 14px;"
              />
              <button type="button" class="btn-primary" id="next-word-btn" style="margin-top: 12px; width: 100%;">
                ë‹¤ìŒ ë‹¨ì–´
              </button>
            </div>
          `;

          const playBtn = document.getElementById("play-word-btn");
          const nextBtn = document.getElementById("next-word-btn");
          const input = document.getElementById(`speech-input-${currentSpeechTestIndex}`);

          playBtn.addEventListener("click", function() {
            speakWord(word);
          });

          nextBtn.addEventListener("click", function() {
            const userAnswer = input.value.trim();
            speechTestAnswers.push({
              word: word,
              userAnswer: userAnswer,
              correct: userAnswer.toLowerCase() === word.toLowerCase()
            });
            currentSpeechTestIndex++;
            playNextWord();
          });

          // Enter í‚¤ë¡œ ë‹¤ìŒ ë‹¨ì–´ë¡œ ì´ë™
          input.addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
              nextBtn.click();
            }
          });
        }

        function speakWord(word) {
          if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'ko-KR';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
          } else {
            alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          }
        }

        function showSpeechTestResults() {
          const correctCount = speechTestAnswers.filter(a => a.correct).length;
          const clarityPercent = (correctCount / SPEECH_TEST_WORDS.length) * 100;
          
          const container = document.getElementById("speech-test-items");
          container.innerHTML = `
            <div style="margin-bottom: 12px;">
              <div class="hint">í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div>
              <div style="margin-top: 8px;">
                ${speechTestAnswers.map((a, i) => `
                  <div style="padding: 6px 0; border-bottom: 1px solid rgba(51, 65, 85, 0.3);">
                    <span style="color: ${a.correct ? '#4ade80' : '#f97373'};">
                      ${a.correct ? 'âœ“' : 'âœ—'}
                    </span>
                    ${i + 1}. ì •ë‹µ: "${a.word}" / ì…ë ¥: "${a.userAnswer || '(ì…ë ¥ ì—†ìŒ)'}"
                  </div>
                `).join('')}
              </div>
            </div>
          `;

          const resultsDiv = document.getElementById("speech-test-results");
          resultsDiv.style.display = "block";
          document.getElementById("speech-clarity-score").textContent = 
            `ìˆ˜ìŒ ëª…ë£Œë„: ${correctCount}/${SPEECH_TEST_WORDS.length} (${clarityPercent.toFixed(0)}%)`;
        }

        function updateAudioProgressAsComplete() {
          var progress = {
            label: "Mimi ì²­ë ¥ ì¸¡ì • ìš”ì•½",
            current: 3,
            total: 3,
            completedAt: new Date().toISOString(),
          };
          if (typeof GAStorage !== "undefined") {
            GAStorage.writeProgress("audio", progress);
          }
        }

        form.addEventListener("submit", (event) => {
          event.preventDefault();
          if (!validate()) {
            statusText.textContent =
              "í•„ìˆ˜ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ë¶‰ì€ ë¬¸êµ¬ê°€ í‘œì‹œëœ ì…ë ¥ê°’ì„ ë¨¼ì € ì±„ì›Œì•¼ í•©ë‹ˆë‹¤.";
            statusText.className = "status-text status-text--error";
            return;
          }

          const hearingResult = collectFormData();

          // ê¸°ì¡´ ì„¸ì…˜ ë°ì´í„°ì— hearing ê²°ê³¼ ë³‘í•©
          const session = (typeof GAStorage !== "undefined" && GAStorage.readSession()) || {};
          if (!session.user_data) session.user_data = {};
          const hearing = session.user_data.hearing_results || {};
          Object.assign(hearing, hearingResult);
          writeSession({
            hearing: hearing,
          });

          // ì²­ê° ì¸¡ì • ì§„í–‰ë¥  ì™„ë£Œ ì²˜ë¦¬
          updateAudioProgressAsComplete();

          statusText.textContent =
            "ì²­ê°ì–¸ì–´ì¥ì•  ì¸¡ì • ê²°ê³¼ê°€ ì„¸ì…˜ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. í—ˆë¸Œë¡œ ëŒì•„ê°‘ë‹ˆë‹¤...";
          statusText.className = "status-text status-text--ok";

          setTimeout(() => {
            window.location.href = "hub.html";
          }, 600);
        });

        backToHubButton.addEventListener("click", () => {
          window.location.href = "hub.html";
        });

        document.getElementById("start-speech-test").addEventListener("click", startSpeechTest);

        updateUserSummary();
      })();
    </script>
  </body>
</html>

